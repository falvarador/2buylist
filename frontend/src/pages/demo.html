<!DOCTYPE html>
<html lang="es" x-data="app()" :class="{ 'dark': darkMode }" x-init="init()">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShoppingApp Pro | Sortable & Modal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: {
                        brand: '#22c55e',
                        darkBg: '#111827',
                        darkSidebar: '#1f2937'
                    }
                }
            }
        }
    </script>
    <style>
        [x-cloak] {
            display: none !important;
        }

        .sortable-ghost {
            opacity: 0.3;
            background: #d1fae5;
        }

        .dark .sortable-ghost {
            background: #064e3b;
        }
    </style>
</head>

<body
    class="bg-[#f9fafb] dark:bg-darkBg text-slate-900 dark:text-slate-100 antialiased transition-colors duration-300 font-sans">

    <div class="flex h-screen overflow-hidden">

        <aside
            class="w-80 bg-white dark:bg-darkSidebar border-r border-slate-200 dark:border-slate-800 flex-col hidden lg:flex">
            <div class="p-6 flex justify-between items-center">
                <h1 class="text-2xl font-bold tracking-tight">My Lists</h1>
                <button @click="darkMode = !darkMode" class="text-slate-400 hover:text-brand transition-colors">
                    <i :class="darkMode ? 'fa-sun' : 'fa-moon'" class="fas text-lg"></i>
                </button>
            </div>

            <nav id="sidebar-lists" class="flex-1 overflow-y-auto px-4 space-y-1 py-2">
                <template x-for="(list, index) in lists" :key="list.id">
                    <div @click="currentListIndex = index" :data-id="list.id"
                        :class="currentListIndex === index ? 'bg-emerald-50 dark:bg-brand/10 border-l-4 border-brand' : 'border-l-4 border-transparent hover:bg-slate-50 dark:hover:bg-slate-800'"
                        class="group flex items-center p-3 rounded-r-xl cursor-pointer transition-all relative">

                        <div
                            class="absolute left-0 opacity-0 group-hover:opacity-100 cursor-grab active:cursor-grabbing px-1 text-slate-300">
                            <i class="fas fa-grip-vertical text-xs"></i>
                        </div>

                        <div :class="currentListIndex === index ? 'bg-white dark:bg-brand text-brand dark:text-white' : 'bg-slate-100 dark:bg-slate-800 text-slate-500'"
                            class="w-10 h-10 rounded-xl flex items-center justify-center mr-4 shadow-sm transition-colors ml-2">
                            <i :class="list.icon" class="fas text-sm"></i>
                        </div>
                        <div class="flex-1">
                            <p class="font-semibold text-sm"
                                :class="currentListIndex === index ? 'text-emerald-700 dark:text-emerald-400' : 'text-slate-700 dark:text-slate-300'"
                                x-text="list.name"></p>
                            <p class="text-[11px] text-slate-400 font-medium" x-text="`${list.items.length} items`"></p>
                        </div>
                    </div>
                </template>
            </nav>

            <div class="p-6">
                <button @click="showModal = true"
                    class="w-full bg-brand hover:bg-emerald-600 text-white font-bold py-4 rounded-xl flex items-center justify-center gap-2 shadow-lg shadow-emerald-500/20 transition-all active:scale-95">
                    <i class="fas fa-plus text-xs"></i> New List
                </button>
            </div>
        </aside>

        <main class="flex-1 overflow-y-auto flex flex-col">
            <div class="max-w-4xl mx-auto w-full px-10">
                <div class="py-6 flex items-center justify-between">
                    <div class="flex items-center gap-2 text-xs font-medium text-slate-400 uppercase tracking-widest">
                        <i class="fas fa-home"></i>
                        <span>/</span>
                        <span class="text-slate-600 dark:text-slate-200" x-text="lists[currentListIndex].name"></span>
                    </div>
                    <div class="flex -space-x-2">
                        <img src="https://i.pravatar.cc/150?u=4"
                            class="w-8 h-8 rounded-full border-2 border-white dark:border-darkBg">
                        <div
                            class="w-8 h-8 rounded-full bg-slate-100 dark:bg-slate-800 border-2 border-white dark:border-darkBg flex items-center justify-center text-[10px] font-bold text-slate-500">
                            +2
                        </div>
                    </div>
                </div>

                <div class="mb-8">
                    <h2 class="text-4xl font-bold text-slate-800 dark:text-white mb-1"
                        x-text="lists[currentListIndex].name"></h2>
                    <p class="text-brand font-semibold text-sm" x-text="`${pendingCount()} items remaining`"></p>
                </div>

                <div
                    class="bg-white dark:bg-darkSidebar rounded-3xl border border-slate-200 dark:border-slate-800 shadow-sm overflow-hidden mb-12">
                    <div
                        class="p-4 bg-slate-50/50 dark:bg-slate-800/30 border-b border-slate-100 dark:border-slate-800 flex items-center gap-4">
                        <div
                            class="w-8 h-8 rounded-full bg-slate-200 dark:bg-slate-700 flex items-center justify-center text-slate-500">
                            <i class="fas fa-plus text-[10px]"></i>
                        </div>
                        <input type="text" x-model="newItem" @keyup.enter="addItem()"
                            class="flex-1 bg-transparent border-none outline-none text-slate-600 dark:text-slate-300 placeholder:text-slate-400"
                            placeholder="Add a new item...">
                        <div
                            class="hidden sm:block text-[10px] font-bold text-slate-300 border border-slate-200 dark:border-slate-700 px-2 py-1 rounded-md">
                            ↵ Enter
                        </div>
                    </div>

                    <div class="divide-y divide-slate-50 dark:divide-slate-800">
                        <template x-for="(item, index) in lists[currentListIndex].items" :key="item.id">
                            <div
                                class="group flex items-center p-6 hover:bg-slate-50/50 dark:hover:bg-slate-800/20 transition-all">
                                <input type="checkbox" x-model="item.completed"
                                    class="w-6 h-6 rounded-md border-2 border-slate-200 dark:border-slate-700 text-brand focus:ring-brand cursor-pointer">
                                <span class="flex-1 ml-6 font-medium text-slate-700 dark:text-slate-300"
                                    :class="item.completed ? 'line-through text-slate-400' : ''"
                                    x-text="item.text"></span>
                                <button @click="removeItem(index)"
                                    class="opacity-0 group-hover:opacity-100 text-slate-300 hover:text-red-500 transition-all p-2">
                                    <i class="fas fa-trash-alt text-lg"></i>
                                </button>
                            </div>
                        </template>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div x-show="showModal" x-cloak class="fixed inset-0 z-[100] flex items-center justify-center p-4">
        <div x-show="showModal" x-transition:enter="ease-out duration-300" x-transition:enter-start="opacity-0"
            x-transition:enter-end="opacity-100" @click="showModal = false"
            class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm"></div>

        <div x-show="showModal" x-transition:enter="ease-out duration-300" x-transition:enter-start="opacity-0 scale-95"
            x-transition:enter-end="opacity-100 scale-100"
            class="relative w-full max-w-md bg-white dark:bg-darkSidebar rounded-[2.5rem] p-8 shadow-2xl shadow-black/20">

            <h3 class="text-2xl font-bold mb-6 text-slate-800 dark:text-white">Create New List</h3>

            <div class="space-y-4">
                <div>
                    <label class="text-[10px] font-bold uppercase tracking-widest text-slate-400 mb-2 block ml-1">List
                        Name</label>
                    <input type="text" x-model="newList.name" placeholder="E.g. Monthly Grocery"
                        class="w-full bg-slate-100 dark:bg-slate-800 border-none rounded-2xl py-4 px-6 outline-none focus:ring-2 focus:ring-brand/20 transition-all">
                </div>

                <div>
                    <label class="text-[10px] font-bold uppercase tracking-widest text-slate-400 mb-2 block ml-1">Select
                        Icon</label>
                    <div class="grid grid-cols-4 gap-3">
                        <template x-for="icon in availableIcons">
                            <button @click="newList.icon = icon"
                                :class="newList.icon === icon ? 'bg-brand text-white' : 'bg-slate-100 dark:bg-slate-800 text-slate-500'"
                                class="h-12 rounded-xl flex items-center justify-center transition-all hover:scale-105">
                                <i class="fas" :class="icon"></i>
                            </button>
                        </template>
                    </div>
                </div>
            </div>

            <div class="mt-10 flex gap-3">
                <button @click="showModal = false"
                    class="flex-1 py-4 rounded-xl font-bold text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 transition-all">
                    Cancel
                </button>
                <button @click="createList()"
                    class="flex-1 py-4 bg-brand text-white rounded-xl font-bold shadow-lg shadow-emerald-500/20 active:scale-95 transition-all">
                    Create List
                </button>
            </div>
        </div>
    </div>

    <script>
        function app() {
            return {
                darkMode: window.matchMedia('(prefers-color-scheme: dark)').matches,
                sidebarOpen: false,
                showModal: false,
                currentListIndex: 0,
                newItem: '',
                newList: { name: '', icon: 'fa-shopping-cart' },
                availableIcons: ['fa-shopping-cart', 'fa-fire', 'fa-shopping-bag', 'fa-tools', 'fa-birthday-cake', 'fa-utensils', 'fa-leaf', 'fa-laptop'],

                lists: [
                    {
                        id: '1',
                        name: 'Weekly Groceries',
                        icon: 'fa-shopping-cart',
                        items: [{ id: 101, text: 'Organic Milk', completed: false }, {
                            id: 102,
                            text: 'Coffee Beans',
                            completed: true
                        }]
                    },
                    { id: '2', name: 'Weekend BBQ', icon: 'fa-fire', items: [] },
                    { id: '3', name: 'Target Run', icon: 'fa-shopping-bag', items: [] }
                ],

                init() {
                    // Inicializar Drag & Drop
                    const el = document.getElementById('sidebar-lists')
                    Sortable.create(el, {
                        animation: 150,
                        ghostClass: 'sortable-ghost',
                        handle: '.group', // Se puede arrastrar desde cualquier parte del item
                        onEnd: (evt) => {
                            // Reordenar el array en Alpine
                            const movedItem = this.lists.splice(evt.oldIndex, 1)[0]
                            this.lists.splice(evt.newIndex, 0, movedItem)
                            // Ajustar el índice actual para que no se pierda la selección
                            this.currentListIndex = evt.newIndex
                        }
                    })
                },

                addItem() {
                    if (!this.newItem.trim()) return
                    this.lists[this.currentListIndex].items.unshift({
                        id: Date.now(),
                        text: this.newItem,
                        completed: false
                    })
                    this.newItem = ''
                },

                removeItem(index) {
                    this.lists[this.currentListIndex].items.splice(index, 1)
                },

                createList() {
                    if (!this.newList.name.trim()) return
                    this.lists.push({
                        id: Date.now().toString(),
                        name: this.newList.name,
                        icon: this.newList.icon,
                        items: []
                    })
                    this.currentListIndex = this.lists.length - 1
                    this.newList = { name: '', icon: 'fa-shopping-cart' }
                    this.showModal = false
                },

                pendingCount() {
                    return this.lists[this.currentListIndex].items.filter(i => !i.completed).length
                }
            }
        }
    </script>
</body>

</html>